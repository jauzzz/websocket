---
改用 aioredis
---

## 加入测试

单个房间 (test_join)
- 1
- 100
- 1000
- 1500
- 2000
- 2500
- 2800
- 3000
- 4000 (Too many open files in system) (ulimit -n 8192 情况下) (最终记录到 3417)
- 4000 (Too many open files in system) (ulimit -n 10000 情况下) (最终记录到 2999)

多个房间 (test_join_room)
- 2000
- 3000
- 4000 (Too many open files in system) (最终记录到 3454)


## 加入离开测试
这里测试脚本有个问题
随着测试数量的增大，leave需要等待的时间也要相应增大（留给服务器 redis set value 的机会）(并且并发也不是按序的)

1000 个客户端大概需要 3 秒

### 离开概率：100%
单个房间 (test_join_leave) 
- 1
- 10
- 100
- 500
- 1000
- 2000
- 3000
- 4000 (too many open files)

- 多个房间 (test_join_leave_room)
- 1
- 10
- 100
- 500
- 1000
- 2000
- 3000
- 4000 (too many open files)

### 离开概率: 33%
单个房间 (test_join_leave) 
- 100 (加入66，离开34，总加入100)
- 1000 (加入666，离开334，总加入1000)
- 3000 (加入2000，离开1000，总加入3000)

- 多个房间 (test_join_leave_room)
- 100 (加入66，离开34，总加入100)
- 1000 (加入666，离开334，总加入1000)
- 3000 (加入2000，离开1000，总加入3000)

## 加入、断开（多房间）(test_join_disconnect)

disconnect 的操作不是马上的，有些要等
1000 个客户端大概等待 3 秒

断开概率: 33%
- 10 (加入6，断开4，总共 10)
- 100 (加入66，断开34，总共 100)
- 1000 (加入666，断开334，总共 1000)
- 3000 (加入2000，断开1000，总共3000)

## 加入、断开、异常重连 (test_exception)

断开概率: 33%
断开后，重连概率: 50%

- 100 (加入83，断开34，未重连的有17，最终结果 83 + 17 = 100)
- 1000 (加入833，断开334，未重连的有167，结果 833 + 167 = 1000，最终稳定记录值 810))
- 3000 (加入2500，断开1000，未重连的500，结果 2500 + 500 = 3000， 最终稳定记录值 2462))
